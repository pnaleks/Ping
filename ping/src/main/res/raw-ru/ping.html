<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
 <title>MAN ping (8)</title>
 <style type="text/css">
  body {color:black;background-color:white}
  h2 {color:#2da79c;font-size:80%}
  dt {font-family: monospace}
 </style>
</head>
<body>
<h2>ИМЯ<a name="lbAB">&nbsp;</a></h2>
ping, ping6 - посылает пакеты ICMP ECHO_REQUEST хостам сети

<h2>ОБЗОР<a name="lbAC">&nbsp;</a></h2>
<p>
<b>ping</b>
 [ <b>-LRUbdfnqrvVaAB</b>]
 [ <b>-c </b><i>количество</i><b></b>]
 [ <b>-i </b><i>интервал</i><b></b>]
 [ <b>-l </b><i>преднагрузка</i><b></b>]
 [ <b>-p </b><i>шаблон</i><b></b>]
 [ <b>-s </b><i>размер-пакета</i><b></b>]
 [ <b>-t </b><i>ttl</i><b></b>]
 [ <b>-w </b><i>ограничение-на-время-работы</i><b></b>]
 [ <b>-F </b><i>идентификатор-потока</i><b></b>]
 [ <b>-I </b><i>адрес</i><b></b>]
 [ <b>-M </b><i>указание</i><b></b>]
 [ <b>-Q </b><i>тип-обслуживания</i><b></b>]
 [ <b>-S </b><i>буфер-отправки</i><b></b>]
 [ <b>-T </b><i>параметр-временной-метки</i><b></b>]
 [ <b>-W </b><i>время-ожидания-ответа</i><b></b>]
 [ <b></b><i>переход</i><b></b><i> ...</i>]
 <b></b><i>назначение</i><b></b></p>

<h2>ОПИСАНИЕ<a name="lbAD">&nbsp;</a></h2>
<p>
<b>ping</b> использует обязательные датаграммы ECHO_REQUEST протокола ICMP для получения по этому протоколу ответов
ECHO_RESPONSE от хоста или шлюза.</p>
<p>
Датаграммы ECHO_REQUEST состоят из заголовков IP и ICMP, структуры данных struct timeval и произвольного числа несмысловых
байтов для заполнения пакета.</p>

<h2>ОПЦИИ<a name="lbAE">&nbsp;</a></h2>
<dl compact="compact">
 <dt><b>-a</b></dt><dd>Сопровождать работу программы звуком.</dd>
 <dt><b>-A</b></dt><dd>Адаптировать интервал между отправками пакетов к длительности их доставки и возврата. Таким образом,
если только не выполняется преднагрузка, в любой момент времени может быть не больше одного пакета, на который не получен ответ.
Минимальный интервал для не администратора - 200 мс. В сетях с низким rtt данный режим эквивалентен лавинообразному.</dd>
 <dt><b>-b</b></dt><dd>Разрешить использование широковещательного адреса в качестве целевого.</dd>
 <dt><b>-B</b></dt><dd>Запретить изменение исходного адреса для пакетов во время работы программы. Исходный адрес определяется
в начале работы <b>ping</b>.</dd>
 <dt><b>-c </b><i>количество</i><b></b></dt><dd>Остановить работу после передачи заданного <i>количества</i> пакетов
ECHO_REQUEST. Если задано <i>ограничение-на-время-работы</i>, программа будет ждать указанное <i>количество</i> ответных
пакетов ECHO_REPLY в указанный период.</dd>
 <dt><b>-d</b></dt><dd> Устанавливает параметр SO_DEBUG на используемый сокет. Примечание: этот параметр не используется ядром
Linux.</dd>
 <dt><b>-F </b><i>идентификатор-потока</i><b></b></dt><dd>Устанавливать идентификатор-потока в отправляемых пакетах (только для
<b>ping6</b>). Если указан нуль, идентификатор-потока будет генерироваться случайно ядром.</dd>
 <dt><b>-f</b></dt><dd>Лавинообразный режим. Для каждого пакета ECHO_REQUEST выводится точка (`.'), для каждого ответного
пакета ECHO_REPLY - забой (удаление последней точки). Это позволяет наглядно представлять число потерянных пакетов. Если
интервал между отправками не задан, последние производятся с наибольшей скоростью (по мере получения ответов) или со скоростью
100 раз в секунду, в зависимости от того, в каком случае получается большая скорость. Задавать нулевой интервал между
отправками может только суперпользователь.</dd>
 <dt><b>-i </b><i>интервал</i><b></b></dt><dd><i>Интервал</i> в секундах между отправкой пакетов. По умолчанию между отправкой
пакетов делается пауза в 1 секунду, либо, в случае лавинообразного режима, отправка производится без пауз. Задавать значения
меньше 0.2 может только суперпользователь.</dd>
 <dt><b>-I </b><i>адрес</i><b></b></dt><dd>Установить адрес источника в указанный. В качестве аргумента может выступать
числовой IP-адрес или имя устройства. Этот параметр обязателен при отправке запросов на локально соединённый адрес IPv6.</dd>
 <dt><b>-l </b><i>преднагрузка</i><b></b></dt><dd>Послать с максимальной скоростью указанное количество пакетов, не дожидаясь
ответов, и затем перейти в обычный режим работы. Значения больше 3 может указывать только суперпользователь.</dd>
 <dt><b>-L</b></dt><dd>Подавлять циклические петли для широковещательных пакетов. Этот ключ применяется только если в качестве
целевого адреса указан широковещательный.</dd>
 <dt><b>-n</b></dt><dd>Только цифровой вывод. Не расшифровывать имена (символьный вид) адресов.</dd>
 <dt><b>-p </b><i>шаблон</i><b></b></dt><dd>Можно указать до 16 несмысловых байтов для заполнения пакетов. Это полезно при
диагностике проблем в сети. Например, <b>-p ff</b> заполнит все пакеты единицами символами.</dd>
 <dt><b>-Q </b><i>тип-обслуживания</i><b></b></dt><dd>Разряды байта QoS (Quality of Service - качество обслуживания) для
датаграмм ICMP. <i>Тип-обслуживания</i> может быть либо десятичным либо шестнадцатеричным числом. Обычно (согласно RFC 1349)
это значение интерпретируется так: младший (нулевой) разряд зарезервирован (сейчас используется для управления событиями при
переполнении), разряды 1-4 используются для указания собственно типа обслуживания, и разряды 5-7 для приоритета
(IP-предпочтения). Возможные типы обслуживания: минимизация стоимости - 0x02, максимизация надёжности - 0x04, максимизация
пропускной способности - 0x08 минимизация задержек - 0x10. Одновременно можно указывать только один из четырёх перечисленных
разрядов. Возможный диапазон значения приоритета - от приоритетного (0x20) до управляемого сетью (0xe0). Для указания высокого
приоритета необходимы права суперпользователем (точнее, должно быть доступна возможность CAP_NET_ADMIN). Разряд 0x01 можно
устанавливать только если в ядре включен ECN.
<p>
В RFC 2474 этот байт переопределён как DS (Differentiated Services - дифференцированные службы): разряды 0-1 отведены для
отдельных данных (тут будет использоваться ECN) разряды 2-7 для DSCP (Differentiated Services Codepoint - точка кода
дифференцированных служб)</p></dd>
 <dt><b>-q</b></dt><dd>Выводить только начальные и итоговые данные (не выводить информацию об отдельных запросах).</dd>
 <dt><b>-R</b></dt><dd>Записывать маршрут. Для пакетов ECHO_REQUEST будет включен параметр RECORD_ROUTE и на экран будет
выведен буфер маршрута для возвращённых пакетов. Заметим, что в заголовок IP помещается не больше 9 таких маршрутов. Многие
узлы игнорируют или не отбрасывают этот параметр.</dd>
 <dt><b>-r</b></dt><dd>Не использовать обычные таблицы маршрутизации и передавать данные прямо на компьютер, подключенный к
интерфейсу. Если компьютер не находится в сети с прямым подключением, то возвращается сообщение об ошибке. Этот параметр может
использоваться вместе с <b>-I</b> для проверки локальной системы через интерфейс, по которому не идет маршрутизация (например
после того, как интерфейс был сброшен <b>routed</b>(8)).</dd>
 <dt><b>-s </b><i>размер-пакета</i><b></b></dt><dd>Размер пакетов для пересылки. По умолчанию - 56, что соответствует размеру
64 байта после добавления 8 байтов заголовка ICMP.</dd>
 <dt><b>-S </b><i>буфер-отправки</i><b></b></dt><dd>Размер буфера отправки соединения. По умолчанию буферизируется не больше
одного пакета.</dd>
 <dt><b>-t </b><i>ttl</i><b></b></dt><dd>Время актуальности пакета IP (ttl - Time to Live).</dd>
 <dt><b>-T </b><i>параметр-временной-метки</i><b></b></dt><dd>Параметры временной метки IP. Возможные значения
<i>параметра-временной-метки</i>: <i>tsonly</i> (только временная метка), <i>tsandaddr</i> (временная метка и адреса) и
<i>tsprespec хост1 [хост2 [хост3 [хост4]]]</i> (отмечать переходы).</dd>
 <dt><b>-M </b><i>указание</i><b></b></dt><dd>Стратегия обнаружения маршрута MTU. Возможные значения: <i>do</i> (запретить
фрагментацию, даже локальную), <i>want</i> (выполнять обнаружение PMTU, фрагментировать локально если размер пакета слишком
большой) и <i>dont</i> (не устанавливать флаг DF).</dd>
 <dt><b>-U</b></dt><dd>Выводить полное время прохода (старое поведение). По умолчанию выводится сетевое время прохода, которое
может отличаться от реального, например из-за ошибок DNS.</dd>
 <dt><b>-v</b></dt><dd>Выводить подробную информацию.</dd>
 <dt><b>-V</b></dt><dd>Вывести информацию о версии и закончить работу.</dd>
 <dt><b>-w </b><i>ограничение-на-время-работы</i><b></b></dt><dd>Время, по истечении которого <b>ping</b> завершит свою работу
независимо от количества посланных и принятых пакетов. При указании этого параметра время ожидания для одного пакета
игнорируется и работа может быть завершена ранее указанного срока только в случае получения информации об ошибке (т.е.
уведомления о том, что ответных пакетов точно не будет).</dd>
 <dt><b>-W </b><i>время-ожидания-ответа</i><b></b></dt><dd>Время ожидания (в секундах) ответного пакета. Принимается во
внимание только если не было принято ни одного ответа. В противном случае программа ожидает получения двух ответов.</dd>
</dl>
<p>
При использовании команды <b>ping</b> для локализации неполадки сначала запустите её с адресом локального хоста
для проверки работоспособности локального сетевого интерфейса.
Затем проверяйте связь посредством <b>ping</b> со всё более удалёнными компьютерами и шлюзами.
Время прохождения сигналов в обе стороны и потери пакетов подсчитываются и анализируются позднее.
Если принимаются дублированные пакеты, то они не включаются в статистику
утерянных пакетов, хотя время прохода таких пакетов включается в статистику
минимального/среднего/максимального времени.
После отправки и получения указанного количества пакетов или при 
прерывании работы программы сигналом <b>SIGINT</b> выводится краткий итог работы.
Более краткую статистику можно получить без прерывания процесса с помощью сигнала SIGQUIT.</p>
<p>
Если ответные пакеты не будут получены, то программа завершит работу с кодом выхода 1.
Если указаны <i>количество</i> пакетов и <i>ограничение-на-время-работы</i>,
но по истечении этого времени принято менее запрошенного числа пакетов,
то программа также завершит работу с кодом выхода 1.
При других ошибках выход будет произведен с кодом 2.
Иначе программа завершает работу с кодом 0.
Эти значения позволяют использовать коды выхода для определения доступности серверов и компьютеров в сети.</p>
<p>
Эта программа предназначена для тестирования сетей,
управления сетями и измерения производительности.
Из-за нагрузок, которые она создаёт в сети, неразумно использовать <b>ping</b>
в рабочее время или в автоматических сценариях.</p>

<h2>ОПИСАНИЕ ПАКЕТОВ ICMP<a name="lbAF">&nbsp;</a></h2>
Заголовок IP без параметров имеет размер 20 байтов.
Пакет ICMP ECHO_REQUEST содержит дополнительные 8 байтов, предназначенные для 
заголовка ICMP, и произвольное количество заполняющих байтов (для обеспечения требуемого размера пакета),
определяемое аргументом <i>размер-пакета</i> данных (по умолчанию 56).
Поэтому количество полученных данных из пакета IP типа ICMP ECHO_REPLY 
всегда будет на 8 байтов (заголовок ICMP) больше, чем задаваемое.
<p>
Если заданный размер данных не меньше размера struct timeval,
то программа включает в них временную метку,
используемую для измерения времени прохода сигнала в обе стороны.
В противном случае такое время не будет измеряться.</p>

<h2>ПОВТОРЯЮЩИЕСЯ И ПОВРЕЖДЁННЫЕ ПАКЕТЫ<a name="lbAG">&nbsp;</a></h2>
Программа выводит сообщения о дублированных и повреждённых пакетах.
Дублированные пакеты свидетельствуют о ненадёжной связи на уровне канала.
Они могут появляться в разных ситуациях и если это происходит с небольшой частотой, то на это можно не обращать внимания.
<p>
Повреждённые пакеты являются прямым свидетельством неполадок в аппаратной части на одном из участков сети,
через который проходили пакеты.</p>

<h2>ТЕСТИРОВАНИЕ НА РАЗЛИЧНЫХ ДАННЫХ<a name="lbAH">&nbsp;</a></h2>
(Меж)сетевая часть механизма передачи данных не должна обрабатывать пакеты по-разному,
в зависимости от содержащихся в них данных.
К сожалению такие проблемы часто встречаются в сетях и остаются невыявленными достаточно долго.
Во многих случаях оказывается, что некорректно обрабатывается некоторый вырожденный шаблон,
например, состоящий из одних нулей или единиц, либо близкий к нему.
Простой проверки по вырожденным шаблонам данных недостаточно,
т.к речь идёт о данных на уровне канала данных,
которые могут соотноситься с указываемыми вами данными самым сложным образом.
<p>
В любом случае, такие проблемы означают, что вам предстоит очень много
работ по тестированию и выявлению вышедшего из строя элемента.
Если вам повезёт, то вы найдёте файл, который вообще не будет 
передаваться по сети, или будет передаваться очень долго (по сравнению с
 файлами такого же размера),
и затем сможете исследовать его на предмет возможных проблемных 
шаблонов,
проверить которые можно с помощью ключа <b>-p</b> программы <b>ping</b>.</p>

<h2>ВРЕМЯ АКТУАЛЬНОСТИ (TTL)<a name="lbAI">&nbsp;</a></h2>
Значение TTL для пакетов IP задаёт максимальное количество IP-маршрутизаторов,
через которое пакет ещё будет доставляться, а не считаться утерянным.
Сейчас каждый маршрутизатор в Интернете уменьшает поле TTL при обработке пакета на единицу.
<p>
Согласно спецификации TCP/IP значение поля TTL для пакетов TCP должно быть равно 60,
но многие системы используют меньшие значения (4.3 BSD использует 30, 4.2 использует 15).</p>
<p>
Максимальное значение данного поля равно 255, и многие Unix-системы
устанавливают поле TTL для пакетов ICMP ECHO_REQUEST в 255.
Поэтому иногда получается, что вы можете проверить связь командой `ping'
до некоторых компьютеров, но не можете связаться с ними программами <b>telnet</b>(1) или <b>ftp</b>(1).</p>
<p>
В обычном режиме ping выводит значения времени актуальности принятых (возвращённых) пакетов.
При приёме пакета удалённой системой она может выполнить одно из трёх возможных действий с полем TTL в ответ:</p>

<ul compact="compact">
<li>Не изменять его; это делали системы Berkeley Unix до выпуска BSD 4.3 Tahoe. TTL в принятом пакете будет 255 минус
количество пройденных маршрутизаторов на пути в обе стороны.</li>
<li>Установить его в 255: это то, что системы Berkeley Unix делают сейчас. В этом случае значение TTL в принятом пакете будет
255 минус количество пройденных маршрутизаторов <b>от</b> удалённой системы <b>до</b> исходной.</li>
<li>Установить его в какое-либо другое значение. Некоторые машины устанавливают его равным используемому для TCP пакетов,
например, либо 30 либо 60. Другие системы могут использовать вообще непредсказуемые значения.</li>
</ul>

<h2>ИЗВЕСТНЫЕ ОШИБКИ<a name="lbAJ">&nbsp;</a></h2>
<ul compact="compact">
<li>Многие узлы и шлюзы игнорируют параметр RECORD_ROUTE.</li>
<li>Максимальная длина заголовка IP слишком мала для полноценной работы таких параметров, как RECORD_ROUTE.</li>
<li>Использовать лавинообразный режим вообще не рекомендуется, а в случаях когда целью является широковещательный адрес,
лавинообразный режим следует применять в условиях тщательного контроля.</li>
</ul>

<h2>СМ. ТАКЖЕ<a name="lbAK">&nbsp;</a></h2>
<p><b>netstat</b>(1), <b>ifconfig</b>(8).</p>

<h2>ИСТОРИЯ<a name="lbAL">&nbsp;</a></h2>
<p>Команда <b>ping</b> впервые появилась в 4.3BSD.</p>
<p>Настоящим документом описывается адаптированная для Linux версия программы.</p>

<h2>БЕЗОПАСНОСТЬ<a name="lbAM">&nbsp;</a></h2>
<p>Для <b>ping</b> требуется функция CAP_NET_RAWIO. На программу может быть установлен бит set-uid root.</p>

<h2>РАСПРОСТРАНЕНИЕ<a name="lbAN">&nbsp;</a></h2>
<p><b>ping</b> является частью пакета <i>iputils</i></p>

<h2>ПЕРЕВОД<a name="lbAO">&nbsp;</a></h2>
Николай Шафоростов &lt;shafff@ukr.net&gt; 2007

<hr>
<h2><a name="index">&nbsp;</a>Index</h2>
<ul>
 <li><a href="#lbAB">ИМЯ</a></li>
 <li><a href="#lbAC">ОБЗОР</a></li>
 <li><a href="#lbAD">ОПИСАНИЕ</a></li>
 <li><a href="#lbAE">ОПЦИИ</a></li>
 <li><a href="#lbAF">ОПИСАНИЕ ПАКЕТОВ ICMP</a></li>
 <li><a href="#lbAG">ПОВТОРЯЮЩИЕСЯ И ПОВРЕЖДЁННЫЕ ПАКЕТЫ</a></li>
 <li><a href="#lbAH">ТЕСТИРОВАНИЕ НА РАЗЛИЧНЫХ ДАННЫХ</a></li>
 <li><a href="#lbAI">ВРЕМЯ АКТУАЛЬНОСТИ (TTL)</a></li>
 <li><a href="#lbAJ">ИЗВЕСТНЫЕ ОШИБКИ</a></li>
 <li><a href="#lbAK">СМ. ТАКЖЕ</a></li>
 <li><a href="#lbAL">ИСТОРИЯ</a></li>
 <li><a href="#lbAM">БЕЗОПАСНОСТЬ</a></li>
 <li><a href="#lbAN">РАСПРОСТРАНЕНИЕ</a></li>
 <li><a href="#lbAO">ПЕРЕВОД</a></li>
</ul>
<hr>
</body></html>
